<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="cbarz">
<meta name="dcterms.date" content="2023-07-10">
<meta name="description" content="If your question is: how can objects be arranged or cutted in an optimal way? you should have a look at the strip packing problem.">

<title>../../blog - Strip packing problem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Strip packing problem</h1>
                  <div>
        <div class="description">
          If your question is: how can objects be arranged or cutted in an optimal way? you should have a look at the strip packing problem.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">modeling</div>
                <div class="quarto-category">generalized disjunctive programming</div>
                <div class="quarto-category">pyomo</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>cbarz </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 10, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#content" id="toc-content" class="nav-link active" data-scroll-target="#content">Content</a>
  <ul class="collapse">
  <li><a href="#problem-description" id="toc-problem-description" class="nav-link" data-scroll-target="#problem-description">Problem description</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications">Applications</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#heuristic-first-in-first-out" id="toc-heuristic-first-in-first-out" class="nav-link" data-scroll-target="#heuristic-first-in-first-out">Heuristic: First-in-first-out</a></li>
  <li><a href="#simple-packing---model" id="toc-simple-packing---model" class="nav-link" data-scroll-target="#simple-packing---model">“simple packing” - Model</a>
  <ul class="collapse">
  <li><a href="#algebraic-model" id="toc-algebraic-model" class="nav-link" data-scroll-target="#algebraic-model">algebraic model</a>
  <ul class="collapse">
  <li><a href="#sets" id="toc-sets" class="nav-link" data-scroll-target="#sets">sets</a></li>
  <li><a href="#param" id="toc-param" class="nav-link" data-scroll-target="#param">param</a></li>
  <li><a href="#vars" id="toc-vars" class="nav-link" data-scroll-target="#vars">vars</a></li>
  <li><a href="#constraints" id="toc-constraints" class="nav-link" data-scroll-target="#constraints">constraints</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">objective</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">model</a></li>
  <li><a href="#remark" id="toc-remark" class="nav-link" data-scroll-target="#remark">Remark</a></li>
  </ul></li>
  <li><a href="#pyomo-implementation" id="toc-pyomo-implementation" class="nav-link" data-scroll-target="#pyomo-implementation">Pyomo implementation</a></li>
  </ul></li>
  <li><a href="#add-rotation-to-model" id="toc-add-rotation-to-model" class="nav-link" data-scroll-target="#add-rotation-to-model">Add rotation to model</a>
  <ul class="collapse">
  <li><a href="#algebraic-model-with-roation" id="toc-algebraic-model-with-roation" class="nav-link" data-scroll-target="#algebraic-model-with-roation">algebraic model with roation</a></li>
  <li><a href="#pyomo-implementation-1" id="toc-pyomo-implementation-1" class="nav-link" data-scroll-target="#pyomo-implementation-1">Pyomo implementation</a></li>
  </ul></li>
  <li><a href="#packing-in-2-dimensions-with-rotation" id="toc-packing-in-2-dimensions-with-rotation" class="nav-link" data-scroll-target="#packing-in-2-dimensions-with-rotation">Packing in 2 dimensions with rotation</a>
  <ul class="collapse">
  <li><a href="#algebraic-model-1" id="toc-algebraic-model-1" class="nav-link" data-scroll-target="#algebraic-model-1">algebraic model</a>
  <ul class="collapse">
  <li><a href="#additional-constraints" id="toc-additional-constraints" class="nav-link" data-scroll-target="#additional-constraints">Additional constraints</a></li>
  <li><a href="#model-1" id="toc-model-1" class="nav-link" data-scroll-target="#model-1">Model</a></li>
  </ul></li>
  <li><a href="#pyomo-implementation-2" id="toc-pyomo-implementation-2" class="nav-link" data-scroll-target="#pyomo-implementation-2">Pyomo implementation</a></li>
  </ul></li>
  <li><a href="#scip-implementation" id="toc-scip-implementation" class="nav-link" data-scroll-target="#scip-implementation">SCIP implementation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="content" class="level1">
<h1>Content</h1>
<p>In this blog post we give a brief intorduction to the strip packing problem and its application. We will see for different variants of the problem the algebraic represenations as a MILP and pyomo implementions using the <a href="https://pyomo.readthedocs.io/en/stable/modeling_extensions/gdp/index.html">GDP extension for generalized disjunctive programming</a>.</p>
<p>In case that your are not familiar with disjunctive programming, let me briefly describe it as a framework to include logic or conditional contraints in an algebraic model. Typical applications of disjunctive programming are: ordering of tasks (e.g.&nbsp;in a production process), choosing optimal route in a circuit of organizing complex projects in a time saving manner. Typical techniques are refomulation as mixed interger program, Big-M reformulation and Hull reformulation.</p>
<section id="problem-description" class="level2">
<h2 class="anchored" data-anchor-id="problem-description">Problem description</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Strip_packing_problem">strip packing problem</a> is a cutting and packing problem. In its basic form we want to pack rectangles on a two dimensional strip of fixed width and virtually infinite height. In other variants consider the different geometry of the packed objects, the dimension (e.g.&nbsp;backing of boxes in 3 dimensions) or the structure of the packing, e.g.&nbsp;<a href="https://en.wikipedia.org/wiki/Guillotine_cutting">guillotine packing</a>. The strip packing problem contains as a special case the <a href="https://en.wikipedia.org/wiki/Bin_packing_problem">bin packing problem</a> and hence its NP-hard.</p>
<p>There exists various approximation methods, such as heuristics and metaheuristcs, to solve the two dimensional strip packing problem.</p>
</section>
<section id="applications" class="level2">
<h2 class="anchored" data-anchor-id="applications">Applications</h2>
<p>The list of applications mainly steam from which inspired this blog https://mobook.github.io/MO-book/notebooks/03/strip-packing.html:</p>
<ol type="1">
<li>cutting out of a sheet of material with fixed width but “infinite length”, e.g.&nbsp;paper or textitle cuts</li>
<li>placement of marco cells in semiconductor layouts</li>
<li>workstation layout in a manufacturing facility</li>
<li>scheduling allocations of a common resource.</li>
</ol>
<p>My personal motivation was an optimized bed planning in the garden. But because its model containts additional modifications I wanted to blog first about one of its core problem.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyomo.environ <span class="im">as</span> pyo</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyomo.gdp <span class="im">as</span> gdp</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Rectangle </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<p>We randomly generate data. Here each row represents a box of width <span class="math inline">\(w\)</span> and height <span class="math inline">\(h\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># helper functions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">## nb param</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>number_of_boxes <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>shelf_depth <span class="op">=</span> <span class="dv">1</span> <span class="co"># will be overwritten</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1111</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># data generation</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gen_box(number_of_boxes <span class="op">=</span> number_of_boxes, wlow<span class="op">=</span><span class="dv">1</span>, whigh<span class="op">=</span><span class="dv">100</span>, hlow<span class="op">=</span><span class="dv">1</span>, hhigh<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""generates random number_of_boxes data, where width of each box varies between wlow and whigh, and heigth within hlow and hheigth """</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'w'</span>: np.random.randint(wlow, whigh, size <span class="op">=</span> number_of_boxes),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'h'</span>: np.random.randint(hlow, hhigh, size <span class="op">=</span> number_of_boxes),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">## data generation</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>boxes <span class="op">=</span> gen_box()</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span>{</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'data'</span> : boxes,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'solver'</span> : <span class="st">'cbc'</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'model_name'</span>: <span class="st">'strip_packing'</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'shelf_depth'</span> : <span class="dv">2</span> <span class="op">*</span> boxes[<span class="st">'h'</span>].<span class="bu">max</span>()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>shelf_depth <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> data[<span class="st">'data'</span>][<span class="st">'h'</span>].<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>display(data[<span class="st">'data'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>w</th>
      <th>h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>53</td>
    </tr>
    <tr>
      <th>1</th>
      <td>56</td>
      <td>25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>82</td>
      <td>23</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13</td>
      <td>21</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _packing(df):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""temp function to transform input data into a df like the solution for visualization"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> df.copy()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    dt[<span class="st">'x1'</span>] <span class="op">=</span> dt[<span class="st">'w'</span>].cumsum() <span class="op">-</span> dt[<span class="st">'w'</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    dt[<span class="st">'x2'</span>] <span class="op">=</span> dt[<span class="st">'w'</span>].cumsum()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    dt[<span class="st">'y1'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    dt[<span class="st">'y2'</span>] <span class="op">=</span> dt[<span class="st">'h'</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    dt[<span class="st">'r'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dt</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_solution(sol, shelf_depth <span class="op">=</span> shelf_depth):</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""plot items bounding boxes"""</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, x, y, w, h, r <span class="kw">in</span> <span class="bu">zip</span>(sol.index, sol[<span class="st">'x1'</span>], sol[<span class="st">'y1'</span>], sol[<span class="st">'w'</span>], sol[<span class="st">'h'</span>], sol[<span class="st">'r'</span>]):</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="st">'g'</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if box rotated then exchange heigth and width and use red as color</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            h, w <span class="op">=</span> w, h</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> <span class="st">'r'</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        ax.add_patch(Rectangle((x, y), w, h, </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                               edgecolor<span class="op">=</span><span class="st">'k'</span>, facecolor<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># place item name in the middle of each box</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        ax.annotate(i, (x<span class="op">+</span>w<span class="op">/</span><span class="dv">2</span>, y<span class="op">+</span>h<span class="op">/</span><span class="dv">2</span>), color<span class="op">=</span><span class="st">'w'</span>, weight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set axis limits</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">1.1</span><span class="op">*</span>sol[<span class="st">"w"</span>].<span class="bu">sum</span>())</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, shelf_depth<span class="op">*</span><span class="fl">1.1</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw line for total used width</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    ax.axvline(sol[<span class="st">"x2"</span>].<span class="bu">max</span>(), ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> shelf_depth<span class="op">/</span>ax.get_ylim()[<span class="dv">1</span>],</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="st">"shelf width $W$"</span>, color<span class="op">=</span><span class="st">"r"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    ax.fill_between([<span class="dv">0</span>, ax.get_xlim()[<span class="dv">1</span>]], [shelf_depth, shelf_depth], color<span class="op">=</span><span class="st">"c"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'packing'</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"width"</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"heigth"</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="heuristic-first-in-first-out" class="level1">
<h1>Heuristic: First-in-first-out</h1>
<p>An obivious solution to the strip packing problem is given by an first-in-first-out heuristic. Which would result in the following packing:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizse fifo packing with no rotation</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>sol <span class="op">=</span> _packing(data[<span class="st">'data'</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>plot_solution(sol, shelf_depth <span class="op">=</span> shelf_depth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="02_strippacking_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="simple-packing---model" class="level1">
<h1>“simple packing” - Model</h1>
<p>Although this simple model is equivalent to a frist-in-first-out strategy and produces a solution everyone can come up with, its a good starting point because its a building block of more elaborated variants.</p>
<section id="algebraic-model" class="level2">
<h2 class="anchored" data-anchor-id="algebraic-model">algebraic model</h2>
<section id="sets" class="level3">
<h3 class="anchored" data-anchor-id="sets">sets</h3>
<ul>
<li><span class="math inline">\(I=\{1,\ldots,n\}\)</span> set of boxes to be packed</li>
<li><span class="math inline">\(order:=\{(i,j) | i,j\in I,\; i&lt;j\}\)</span> used to define the packing order</li>
</ul>
</section>
<section id="param" class="level3">
<h3 class="anchored" data-anchor-id="param">param</h3>
<ul>
<li><span class="math inline">\(w_i\)</span> width of box i</li>
<li><span class="math inline">\(h_i\)</span> heigth of box i</li>
</ul>
</section>
<section id="vars" class="level3">
<h3 class="anchored" data-anchor-id="vars">vars</h3>
<ul>
<li><span class="math inline">\(W\)</span> total used width</li>
<li><span class="math inline">\(x1_i\)</span> left x-coordinate of box i</li>
<li><span class="math inline">\(x2_i\)</span> right x-coordinate of box i</li>
<li><span class="math inline">\(y1_i\)</span> left y-coordinate of box i</li>
<li><span class="math inline">\(y2_i\)</span> right 1-coordinate of box i</li>
</ul>
</section>
<section id="constraints" class="level3">
<h3 class="anchored" data-anchor-id="constraints">constraints</h3>
<ul>
<li>box width: left x coordinate and right x coordinate of box i differ by width of box i, i.e.&nbsp;<span class="math inline">\(x_{2,i}=x_{1,i}+w_i\)</span></li>
<li>no box is placed after total used width, i.e.&nbsp;<span class="math inline">\(x_{2,i} \leq W\)</span></li>
<li>no overlap: either box i is placed before j or j before i, i.e.&nbsp;<span class="math inline">\(x_{1,i} \leq x_{1,j}\)</span> or <span class="math inline">\(x_{1,j} \leq x_{1,i}\)</span></li>
</ul>
</section>
<section id="objective" class="level3">
<h3 class="anchored" data-anchor-id="objective">objective</h3>
<ul>
<li>minimize total used width <span class="math inline">\(W\)</span></li>
</ul>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">model</h3>
<p><span class="math display">\[
\begin{array}{lll}
\min &amp; W &amp; \\
s.t. &amp; x_{i,2} \leq W &amp; \forall i\\
     &amp; x_{i,1},x_{i,2} \geq 0 &amp; \forall i\\
     &amp; y_{i,1} = 0 &amp; \forall i\\
     &amp; [x_{i,2}\leq x_{j,1}] \vee [x_{j,2} \leq x_{i,1}] &amp; \forall i &lt; j
\end{array}     
\]</span></p>
</section>
<section id="remark" class="level3">
<h3 class="anchored" data-anchor-id="remark">Remark</h3>
<p>For the variants of the strip packing problem considered here its easy to give bounds on the descision variables as an upper bound on the shelf width. For simplicity we use: <span class="math display">\[
W_B:=\sum w_i
\]</span></p>
</section>
</section>
<section id="pyomo-implementation" class="level2">
<h2 class="anchored" data-anchor-id="pyomo-implementation">Pyomo implementation</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pyomo implementation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SP_simple(data):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""simple strip packing, but useful to study good/new neighboor constraints later"""</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simple upper bound</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    w_bound <span class="op">=</span> data[<span class="st">'data'</span>][<span class="st">'w'</span>].<span class="bu">sum</span>()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># instanciate model</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> pyo.ConcreteModel(data[<span class="st">'model_name'</span>])</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sets</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    m.I <span class="op">=</span> pyo.Set(initialize <span class="op">=</span> data[<span class="st">'data'</span>].index, doc <span class="op">=</span> <span class="st">'items'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    m.Order <span class="op">=</span> pyo.Set(initialize <span class="op">=</span> m.I <span class="op">*</span> m.I, <span class="bu">filter</span> <span class="op">=</span> <span class="kw">lambda</span> m,i,j: i<span class="op">&lt;</span>j)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vars</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    m.x1 <span class="op">=</span> pyo.Var(m.I, domain <span class="op">=</span> pyo.NonNegativeReals, bounds <span class="op">=</span> (<span class="dv">0</span>,w_bound))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    m.x2 <span class="op">=</span> pyo.Var(m.I, domain <span class="op">=</span> pyo.NonNegativeReals, bounds <span class="op">=</span> (<span class="dv">0</span>,w_bound))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    m.W <span class="op">=</span> pyo.Var(domain <span class="op">=</span> pyo.NonNegativeReals, doc <span class="op">=</span> <span class="st">'total width, to be optimized'</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    m.r <span class="op">=</span> pyo.Var(domain <span class="op">=</span> pyo.Boolean, initialize <span class="op">=</span> <span class="va">False</span>, doc <span class="op">=</span> <span class="st">'not used in no rotation model'</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># objective</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    m.OBJ <span class="op">=</span> pyo.Objective(expr <span class="op">=</span> m.W, sense <span class="op">=</span> pyo.minimize)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># param</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Param</span>(m.I)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> w(m,i):</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data[<span class="st">'data'</span>].<span class="bu">filter</span>(items <span class="op">=</span> [i], axis <span class="op">=</span> <span class="dv">0</span>)[<span class="st">'w'</span>].values[<span class="dv">0</span>]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># constraints</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Constraint</span>(m.I, doc <span class="op">=</span> <span class="st">'determines box i size'</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bounding_box(m,i):</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.x2[i] <span class="op">==</span> m.x1[i] <span class="op">+</span> m.w[i]</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Constraint</span>(m.I, doc <span class="op">=</span> <span class="st">'defines total width, to be optimized'</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> total_width(m,i):</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.x2[i] <span class="op">&lt;=</span> m.W</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Disjunction</span>(m.Order, xor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> no_overlap(m, i, j):</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [m.x2[i] <span class="op">&lt;=</span> m.x1[j],</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                m.x2[j] <span class="op">&lt;=</span> m.x1[i]]</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    pyo.TransformationFactory(<span class="st">"gdp.bigm"</span>).apply_to(m)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># choose solver and apply solver</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> pyo.SolverFactory(data[<span class="st">'solver'</span>])</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    solver.solve(m)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract solution</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> data[<span class="st">'data'</span>].copy()</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract coords from solution</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'x1'</span>] <span class="op">=</span> [pyo.value(m.x1[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'x2'</span>] <span class="op">=</span> [pyo.value(m.x2[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># placeholder</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'y1'</span>] <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'y2'</span>] <span class="op">=</span> sol[<span class="st">'h'</span>]</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'r'</span>] <span class="op">=</span> [<span class="va">False</span> <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sol <span class="op">=</span> SP_simple(data)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise sollution</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plot_solution(sol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 104 ms, sys: 10.9 ms, total: 114 ms
Wall time: 481 ms</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="02_strippacking_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="add-rotation-to-model" class="level1">
<h1>Add rotation to model</h1>
<p>Obviously rotating certain boxes would result in a tighter packing. Therefore we add a boolean variable <code>r_i</code> which equals true iff the box was rotated.</p>
<section id="algebraic-model-with-roation" class="level2">
<h2 class="anchored" data-anchor-id="algebraic-model-with-roation">algebraic model with roation</h2>
<p><span class="math display">\[
\begin{array}{lll}
\min &amp; W &amp; \\
s.t. &amp; x_{i,2} \leq W &amp; \forall i\\
     &amp; x_{i,1},x_{i,2} \geq 0 &amp; \forall i\\
     &amp; y_{i,1} = 0 &amp; \forall i\\
     &amp; [x_{i,2}\leq x_{j,1}] \vee [x_{j,2} \leq x_{i,1}] &amp; \forall i &lt; j\\
     &amp; \left[ \begin{array}{ll}
     r_i= &amp; false\\
     x_{i,2} = &amp; x_{i,1} + w_i\\
     y_{i,2} = &amp; y_{i,1} + h_i
     \end{array} \right] \vee
     \left[ \begin{array}{ll}
     r_i= &amp; true\\
     x_{i,2} = &amp; x_{i,1} + h_i\\
     y_{i,2} = &amp; y_{i,1} + w_i
     \end{array}\right] &amp; \forall i &lt; j
\end{array}     
\]</span></p>
</section>
<section id="pyomo-implementation-1" class="level2">
<h2 class="anchored" data-anchor-id="pyomo-implementation-1">Pyomo implementation</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SP_rot(data):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""strip packing with rotation"""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    W_ub <span class="op">=</span> data[<span class="st">'data'</span>][<span class="st">'w'</span>].<span class="bu">sum</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> pyo.ConcreteModel()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sets</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    m.I <span class="op">=</span> pyo.Set(initialize <span class="op">=</span> data[<span class="st">'data'</span>].index, doc <span class="op">=</span> <span class="st">'plants'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    m.Order <span class="op">=</span> pyo.Set(initialize <span class="op">=</span> m.I <span class="op">*</span> m.I, <span class="bu">filter</span> <span class="op">=</span> <span class="kw">lambda</span> m,i,j:i<span class="op">&lt;</span>j, doc <span class="op">=</span><span class="st">'ordering of plants'</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vars</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    m.W <span class="op">=</span> pyo.Var(bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'total optimal width'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    m.x1 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'LHS of item i on x axis'</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    m.x2 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'RHS of item i on x axis'</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    m.y1 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'LHS of item i on y axis'</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    m.y2 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'RHS of item i on y axis'</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    m.r <span class="op">=</span> pyo.Var(m.I, domain <span class="op">=</span> pyo.Boolean)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># objective</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Objective</span>()</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> minimal_width(m):</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.W</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># param</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Param</span>(m.I)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> w(m,i):</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data[<span class="st">'data'</span>].<span class="bu">filter</span>(items <span class="op">=</span> [i], axis <span class="op">=</span> <span class="dv">0</span>)[<span class="st">'w'</span>].values[<span class="dv">0</span>]</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Param</span>(m.I)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> h(m,i):</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data[<span class="st">'data'</span>].<span class="bu">filter</span>(items <span class="op">=</span> [i], axis <span class="op">=</span> <span class="dv">0</span>)[<span class="st">'h'</span>].values[<span class="dv">0</span>]</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># constraints</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Constraint</span>(m.I)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> c1(m,i):</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.x2[i] <span class="op">&lt;=</span> m.W</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Constraint</span>(m.I)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> y1_loc(m,i):</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.y1[i] <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Disjunction</span>(m.I)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rotation(m,i):</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            [m.r[i] <span class="op">==</span> <span class="va">False</span>, </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>             m.x2[i] <span class="op">==</span> m.x1[i] <span class="op">+</span> m.w[i],</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>             m.y2[i] <span class="op">==</span> m.y1[i] <span class="op">+</span> m.h[i]</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>            [m.r[i] <span class="op">==</span> <span class="va">True</span>,</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>             m.x2[i] <span class="op">==</span> m.x1[i] <span class="op">+</span> m.h[i],</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>             m.y2[i] <span class="op">==</span> m.y1[i] <span class="op">+</span> m.w[i]</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Disjunction</span>(m.Order)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> no_overlap(m,i,j):</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            [m.x2[i] <span class="op">&lt;=</span> m.x1[j]],</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>            [m.x2[j] <span class="op">&lt;=</span> m.x1[i]]</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    pyo.TransformationFactory(<span class="st">"gdp.bigm"</span>).apply_to(m)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># choose solver and apply solver</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> pyo.SolverFactory(data[<span class="st">'solver'</span>])</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    solver.solve(m)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract solution</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> data[<span class="st">'data'</span>].copy()</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract coords from solution</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'x1'</span>] <span class="op">=</span> [pyo.value(m.x1[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'x2'</span>] <span class="op">=</span> [pyo.value(m.x2[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># placeholder</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'y1'</span>] <span class="op">=</span> [pyo.value(m.y1[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'y2'</span>] <span class="op">=</span> [pyo.value(m.y2[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'r'</span>] <span class="op">=</span> [pyo.value(m.r[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In order to see when a rotation was applied we plot rotated boxes in red.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sol_rot <span class="op">=</span> SP_rot(data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plot_solution(sol_rot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 99.2 ms, sys: 21 ms, total: 120 ms
Wall time: 561 ms</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="02_strippacking_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="packing-in-2-dimensions-with-rotation" class="level1">
<h1>Packing in 2 dimensions with rotation</h1>
<p>Again obviously we can reduce the required total width if we allow to pack boxes in 2 dimensions, e.g.&nbsp;we place a box behind another.</p>
<section id="algebraic-model-1" class="level2">
<h2 class="anchored" data-anchor-id="algebraic-model-1">algebraic model</h2>
<section id="additional-constraints" class="level3">
<h3 class="anchored" data-anchor-id="additional-constraints">Additional constraints</h3>
<ul>
<li>upper <span class="math inline">\(y\)</span> coordinate of box does not exceed shelf depth <span class="math inline">\(D\)</span></li>
<li>no overlap of boxes in y-axis</li>
</ul>
</section>
<section id="model-1" class="level3">
<h3 class="anchored" data-anchor-id="model-1">Model</h3>
<p><span class="math display">\[
\begin{array}{lll}
\min &amp; W &amp; \\
s.t. &amp; x_{i,2} \leq W &amp; \forall i\\
     &amp; y_{i,2} \leq D &amp; \forall i\\
     &amp; x_{i,1},x_{i,2}, y_{i,1}, y_{i,2} \geq 0 &amp; \forall i\\
     &amp; y_{i,1} = 0 &amp; \forall i\\
     &amp; [x_{i,2}\leq x_{j,1}] \vee
       [x_{j,2} \leq x_{i,1}] \vee       
       [y_{i,2}\leq y_{j,1}] \vee
       [y_{j,2} \leq y_{i,1}]
       &amp; \forall i &lt; j\\
     &amp; \left[ \begin{array}{ll}
     r_i= &amp; false\\
     x_{i,2} = &amp; x_{i,1} + w_i\\
     y_{i,2} = &amp; y_{i,1} + h_i
     \end{array} \right] \vee
     \left[ \begin{array}{ll}
     r_i= &amp; true\\
     x_{i,2} = &amp; x_{i,1} + h_i\\
     y_{i,2} = &amp; y_{i,1} + w_i
     \end{array}\right] &amp; \forall i &lt; j
\end{array}     
\]</span></p>
</section>
</section>
<section id="pyomo-implementation-2" class="level2">
<h2 class="anchored" data-anchor-id="pyomo-implementation-2">Pyomo implementation</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SP_2dim_rot(data):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""strip packing with rotation in 2 dimension"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    W_ub <span class="op">=</span> data[<span class="st">'data'</span>][<span class="st">'w'</span>].<span class="bu">sum</span>()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> pyo.ConcreteModel()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sets</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    m.I <span class="op">=</span> pyo.Set(initialize <span class="op">=</span> data[<span class="st">'data'</span>].index, doc <span class="op">=</span> <span class="st">'plants'</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    m.Order <span class="op">=</span> pyo.Set(initialize <span class="op">=</span> m.I <span class="op">*</span> m.I, <span class="bu">filter</span> <span class="op">=</span> <span class="kw">lambda</span> m,i,j:i<span class="op">&lt;</span>j, doc <span class="op">=</span><span class="st">'ordering of plants'</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vars</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    m.W <span class="op">=</span> pyo.Var(bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'total optimal width'</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    m.x1 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'LHS of item i on x axis'</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    m.x2 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'RHS of item i on x axis'</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    m.y1 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'LHS of item i on y axis'</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    m.y2 <span class="op">=</span> pyo.Var(m.I, bounds <span class="op">=</span> (<span class="dv">0</span>,W_ub), doc <span class="op">=</span> <span class="st">'RHS of item i on y axis'</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    m.r <span class="op">=</span> pyo.Var(m.I, domain <span class="op">=</span> pyo.Boolean)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># objective</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Objective</span>()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> minimal_width(m):</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.W</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># param</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Param</span>(m.I)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> w(m,i):</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data[<span class="st">'data'</span>].<span class="bu">filter</span>(items <span class="op">=</span> [i], axis <span class="op">=</span> <span class="dv">0</span>)[<span class="st">'w'</span>].values[<span class="dv">0</span>]</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Param</span>(m.I)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> h(m,i):</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data[<span class="st">'data'</span>].<span class="bu">filter</span>(items <span class="op">=</span> [i], axis <span class="op">=</span> <span class="dv">0</span>)[<span class="st">'h'</span>].values[<span class="dv">0</span>]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    m.shelf_depth <span class="op">=</span> pyo.Param(mutable <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                              initialize <span class="op">=</span> data[<span class="st">'shelf_depth'</span>])</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># constraints</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Constraint</span>(m.I)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> minimize_width(m,i):</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.x2[i] <span class="op">&lt;=</span> m.W</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Constraint</span>(m.I)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> max_heigth(m,i):</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> m.y2[i] <span class="op">&lt;=</span> m.shelf_depth</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Disjunction</span>(m.I)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rotation(m,i):</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>            [m.r[i] <span class="op">==</span> <span class="va">False</span>, </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>             m.x2[i] <span class="op">==</span> m.x1[i] <span class="op">+</span> m.w[i],</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>             m.y2[i] <span class="op">==</span> m.y1[i] <span class="op">+</span> m.h[i]</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>            [m.r[i] <span class="op">==</span> <span class="va">True</span>,</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>             m.x2[i] <span class="op">==</span> m.x1[i] <span class="op">+</span> m.h[i],</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>             m.y2[i] <span class="op">==</span> m.y1[i] <span class="op">+</span> m.w[i]</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">@m.Disjunction</span>(m.Order)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> no_overlap(m,i,j):</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>            [m.x2[i] <span class="op">&lt;=</span> m.x1[j]],</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>            [m.x2[j] <span class="op">&lt;=</span> m.x1[i]],</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>            [m.y2[i] <span class="op">&lt;=</span> m.y1[j]],</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>            [m.y2[j] <span class="op">&lt;=</span> m.y1[i]]</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    pyo.TransformationFactory(<span class="st">"gdp.bigm"</span>).apply_to(m)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># choose solver and apply solver</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> pyo.SolverFactory(data[<span class="st">'solver'</span>])</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    solver.solve(m)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract solution</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> data[<span class="st">'data'</span>].copy()</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract coords from solution</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'x1'</span>] <span class="op">=</span> [pyo.value(m.x1[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'x2'</span>] <span class="op">=</span> [pyo.value(m.x2[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># placeholder</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'y1'</span>] <span class="op">=</span> [pyo.value(m.y1[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'y2'</span>] <span class="op">=</span> [pyo.value(m.y2[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    sol[<span class="st">'r'</span>] <span class="op">=</span> [pyo.value(m.r[i]) <span class="cf">for</span> i <span class="kw">in</span> m.I]</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sol_rot <span class="op">=</span> SP_2dim_rot(data)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plot_solution(sol_rot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 118 ms, sys: 47.6 ms, total: 166 ms
Wall time: 271 ms</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="02_strippacking_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="scip-implementation" class="level1">
<h1>SCIP implementation</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt <span class="im">as</span> scip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SP_SCIP(data):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> scip.Model(data[<span class="st">'model_name'</span>])</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>{'data':     w   h
 0  29  53
 1  56  25
 2  82  23
 3  13  21
 4  35  12,
 'solver': 'cbc',
 'model_name': 'strip_packing',
 'shelf_depth': 106}</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>SP_SCIP(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;pyscipopt.scip.Model object&gt;</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>